{"componentChunkName":"component---src-templates-{post}-tsx-content-file-path-null","path":"/blog/2024/07-19-spa-404/","result":{"data":{"markdownRemark":{"html":"<h2>개요</h2>\n<p>이 글은 실무에서 정적 사이트 배포 환경을 구성하면서 겪은 SPA 관련 404 오류 이슈에 대한 해결 과정을 다룹니다.</p>\n<h2>SPA란?</h2>\n<p><strong>SPA</strong>(Single-page application)란 단일 HTML 문서로 이루어진 웹사이트를 의미합니다. 기존의 여러 HTML 파일을 사용하던 방식과 달리, SPA는 하나의 HTML 파일을 사용하며 모든 콘텐츠는 JavaScript를 통해 동적으로 생성됩니다.</p>\n<p>Angular를 시작으로 React, Vue 등 다양한 SPA 프레임워크가 등장하며 프론트엔드 개발의 주류로 자리 잡았습니다. SPA는 <strong>클라이언트 사이드 라우팅</strong>을 통해 페이지 이동을 구현하며, 페이지를 새로 로드하지 않고도 화면을 전환할 수 있어 사용자에게 더욱 쾌적한 경험을 제공합니다.</p>\n<h2>클라이언트 사이드 라우팅이란?</h2>\n<p>클라이언트 사이드 라우팅은 SPA에서 사용자가 링크를 클릭할 때 페이지를 새로고침하지 않고도 다른 페이지로 이동할 수 있도록 하는 방식입니다. 주요 기능은 다음과 같습니다.</p>\n<ul>\n<li>\n<p>URL 변경을 감지해 그 경로에 매핑된 컴포넌트를 렌더링합니다.</p>\n</li>\n<li>\n<p>새로고침 없이 사용자의 URL을 임의로 조작합니다.</p>\n</li>\n</ul>\n<p>이 URL 변경 방식은 크게 두 가지로 나뉩니다.</p>\n<ol>\n<li>\n<p><code>window.history</code> API를 사용:</p>\n<p><code>window.history</code> API의 <code>pushState</code>, <code>replaceState</code> 등의 메서드를 사용하여 새로고침을 발생시키지 않고 URL을 변경하는 방식입니다. Svelte의 svelte-routing 라이브러리가 여기에 해당합니다.</p>\n<p>URL의 실제 경로를 변경하므로 정적 사이트로 배포할 경우, 후술할 404 오류 이슈를 유발합니다.</p>\n</li>\n<li>\n<p>hash property를 사용:</p>\n<p>URL의 <a href=\"https://developer.mozilla.org/en-US/docs/Web/API/Location/hash\"><strong>hash property</strong></a>를 사용하는 방식으로 Svelte의 svelte-spa-router 라이브러리가 여기에 해당합니다.</p>\n<p><code>#</code> 뒤에 붙는 서버로는 전송되지 않기 때문에 서버는 이를 인식하지 않고, 항상 동일한 HTML 파일을 반환합니다. 이러한 특성을 이용해 라우팅하는 방식으로, SEO에는 불리한 면이 있습니다.</p>\n</li>\n</ol>\n<p>저는 원래 2번 방식 기반의 라이브러리를 사용했기 때문에 큰 문제가 없었지만, 모종의 이유로 1번 방식으로 교체하면서 이슈를 겪게 되었습니다.</p>\n<h2>SPA routing 404 오류 이슈</h2>\n<p>본디 URL이란 사용자가 원하는 리소스를 요청하기 위한 경로를 의미합니다. 즉, <code>https://foo.bar/baz</code>라는 주소로 요청을 한다면, 서버는 기본적으로 <code>./baz.html</code> 파일을 찾아서 응답으로 전송합니다.</p>\n<p>그러나 SPA는 단일 HTML 파일(<code>./index.html</code>)만이 존재하기 때문에, 다른 경로로 이동한 상태에서 새로고침 등으로 새 문서 로드를 유발하면 404 오류가 발생합니다. 그 경로에 해당하는 HTML이 존재하지 않기 때문입니다.</p>\n<p>한편 해시 라우팅을 사용한다면 이 문제는 발생하지 않습니다. 예를 들어, <code>https://foo.bar/#/baz</code>라는 URL에서 <code>#/baz</code>는 Hash property이므로 서버는 이를 인식하지 못합니다. 따라서 서버는 <code>./index.html</code>을 응답으로 보내게 됩니다.</p>\n<p>어쨌든 이 문제를 해결하기 위해서는 어떤 페이지를 요청하든 항상 <code>./index.html</code>을 반환하도록 처리해야 합니다.</p>\n<h2>AWS S3, CloudFront에서 오류 페이지 핸들링</h2>\n<p>저는 AWS S3와 CloudFront로 배포 환경을 구성했기 때문에 여기서 핸들링을 할 필요가 있었습니다. S3와 CloudFront 둘 다 오류 처리 기능을 제공하기 때문에, 둘 중 하나를 선택할 수 있었습니다.</p>\n<h3>S3에서 오류 처리</h3>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/f528b673a9fa34973bdf4880d06d6709/0d390/s3-static-site-hosting.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 92.22222222222223%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAASCAYAAABb0P4QAAAACXBIWXMAABYlAAAWJQFJUiTwAAACSElEQVR42qWUDVebMBSG+f8/bJ7N7UztpNgCpZSWUiXhG0KAd/emaqvTzW2c83DT5PYluR+xXN/H12/fMZv9wPXNDLe2Ddt2cEXjTxcXsO+W2IsCefExLCklfBL1PB9RFMFfBUiSBHmeg9fYqWo7KHWi696mrmtYVVXBce5gzx0sFkvMabzd7lCQkBASqRAQMkMsa4RphSRvoPse/Su01qibBlbTtmhpB2wZPQyGnhyenBXRKI2qO9qB1l8zjiPptLD4xUdchxvakaCtK/zro5SCVTYd5usYmzA8zk4nh+mM87nfCvIxJcWIk/C/jxHM6xbu9h5byvB2F2O/Tx5jRzFTA4qWgt0PHxfs6JVSNjnDS9eDS5gslyWSrEEkWxxKhU4Pfzy4EWypflpKRFZWKKsGBVHSrmvOPK3JZsC+7BEXPUb6k2E6MTxZmu+eYhjmGsEhh7+7R5CkxvrxA9woMawSAY/CstgkWEYHzIMd7iiRPPbi1Myv05JKqodVc9k0I25We1w6Aa5XMT7PA1y5ES4XG3yxfVw7HmbLAN7ugEUY49YLMV9F9JEDiSZwggg72ZwEs37CutBYCkV0cKVCkGmyPbz7knYtEFOHSPITaoJ8RHTMaMYP7WjCZI7MmRWpwKC5CzS1UW/ai3+fP9M0vcuLOtxEW3j+yvRsSb3NNhUZsrwwTkd+7d9z2IcTTFk+FnaW0fXzKMBVwb3JvNW378E3zvMOg3VIbEg4x0BCWh8viY+K8cefy6asanM87g4WYvu3cEj4yD8Btxdr55JIWNsAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n          <source\n              srcset=\"/static/f528b673a9fa34973bdf4880d06d6709/59d6e/s3-static-site-hosting.webp 180w,\n/static/f528b673a9fa34973bdf4880d06d6709/a3012/s3-static-site-hosting.webp 360w,\n/static/f528b673a9fa34973bdf4880d06d6709/bc514/s3-static-site-hosting.webp 720w,\n/static/f528b673a9fa34973bdf4880d06d6709/260c2/s3-static-site-hosting.webp 1080w,\n/static/f528b673a9fa34973bdf4880d06d6709/f992d/s3-static-site-hosting.webp 1440w,\n/static/f528b673a9fa34973bdf4880d06d6709/098de/s3-static-site-hosting.webp 1472w\"\n              sizes=\"(max-width: 720px) 100vw, 720px\"\n              type=\"image/webp\"\n            />\n          <source\n            srcset=\"/static/f528b673a9fa34973bdf4880d06d6709/e9ff0/s3-static-site-hosting.png 180w,\n/static/f528b673a9fa34973bdf4880d06d6709/f21e7/s3-static-site-hosting.png 360w,\n/static/f528b673a9fa34973bdf4880d06d6709/37523/s3-static-site-hosting.png 720w,\n/static/f528b673a9fa34973bdf4880d06d6709/302a4/s3-static-site-hosting.png 1080w,\n/static/f528b673a9fa34973bdf4880d06d6709/07a9c/s3-static-site-hosting.png 1440w,\n/static/f528b673a9fa34973bdf4880d06d6709/0d390/s3-static-site-hosting.png 1472w\"\n            sizes=\"(max-width: 720px) 100vw, 720px\"\n            type=\"image/png\"\n          />\n          <img\n            class=\"gatsby-resp-image-image\"\n            src=\"/static/f528b673a9fa34973bdf4880d06d6709/37523/s3-static-site-hosting.png\"\n            alt=\"s3-static-site-hosting.png\"\n            title=\"\"\n            loading=\"lazy\"\n            decoding=\"async\"\n            style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n          />\n        </picture>\n  </a>\n    </span></p>\n<p>S3의 <strong>정적 웹 사이트 호스팅(Static website hosting)</strong> 기능을 사용하면 오류 시 보여줄 문서를 설정할 수 있습니다.</p>\n<ul>\n<li>\n<p>장점:</p>\n<ul>\n<li>\n<p>간편하게 설정 가능</p>\n</li>\n<li>\n<p>S3의 기본 기능을 사용하므로 추가적인 비용이 발생하지 않음</p>\n</li>\n</ul>\n</li>\n<li>\n<p>단점:</p>\n<ul>\n<li>\n<p>세부적인 오류 처리 설정이 어려움</p>\n</li>\n<li>\n<p>어디까지나 오류가 발생했을 때 응답으로 전송할 문서를 설정하는 것이기 때문에, 네트워크 상에서 여전히 오류로 간주되어 SEO에 불리할 수 있음</p>\n</li>\n</ul>\n</li>\n</ul>\n<h3>CloudFront에서 오류 처리</h3>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/f55ac2240ebf695fba5b5f5de08cee30/1c1a4/cloudfront-custom-error-response.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 143.33333333333334%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAdCAYAAACqhkzFAAAACXBIWXMAABYlAAAWJQFJUiTwAAADqUlEQVR42p1WyZLbVBTNkg9gE/6N76HYZM+OBZUPgMoqRSioAgIJlXSnO+72bMuTrHmyZQ19uOdKT7aDGYKqjp/ee9J59547yI+SNMVytcLV9TsMRyOMJxP07u5hLRa4u79HfzjU+dyycNvrYTqbge/ESXIRj7jZHwzw7XfPlPTV6z/wy8vfcH1zi59/fYnfX73G8+9f4N3Ne/zw40948/YaSZYhjGNEQnAKJYxkY5/nqOsaZVUqeH84HFAUB+Syx/3dbof9fq9jKoSXoIT8IWm/P8BsNldr+/0+LGuBdZAJGYkLRXNIcRHcI48SpuL2SnTcbGxMJlNMpzMslyvYYabW8eF/Q24I+XN68sPDA6qqwunFNTN+eG/AdzqXd6LNXFyczS11lVamaSbruWqz2+11zEQ/A7OeCWgdSbug0EJrscRwPFbSmaSI7TgaSc/3EUQR/CBAGHIM4YchPJkHMuf7fJbSMPpKSFd9P1ANPc+D43gS0Vxdq+vGnaqqT8bjPffpDZ9XQprJdAjkRJI6cprrejo6ritWhZ1OfJk4zmuFmZ9puFpvsLG3WEh0qSfB+7VYHcVN0tKbJGW+pep+bYJ3Sqgul4VqePu+p7rkh0KFp+gEq8kkL9c5J6gbA0KDVENZ6zTM5GFfAsAAUR/jTqPVBbCyylKhKSejEhoN6bLVusp7Vs1EEpxJXwpB83Kl90VLVLXrRsfGZfk5iLm2bauGjuNKgEIJiAd766gETJUwilVLehSEnEc65z6l4NUGJcYuLzC3fY3s/706C9NUTslyDGypaVm49ODf47wszyrFBIaaccy0tHYfbyEJKSwzfSAde7laS1eeYzQaa9fmOlNDe+J+r2nzYfO4SMgKYISnUsskDKNQRXc9vwsM7xksBoGRPrAPCvK2hXV5SEJe9nYrlbHR4BzaDtLlWjuWhuikD5qeeUbIXGpq2NUEb1LH1fWP11ATtBJXLYzGU9zc9jAYjnE/GEluOurqVg5yXF9alYstDxasN1tdZ3l2eWgsZCnxQVc6DhsAWxJdODaGpE3uBtogZM4Ep8t/IaRro/GkbRChWv1PHyUDvsugNV3cNIc2KH7QVEsip2sUu49QcYJ2rSiRF3JoWSPOpNuYoBh3iNP2FNPVS0jSBqGPJHKRCrLYQxJ6x8+owVGfy38zuDeWD5gb7XB4/jmGX3yC4ZPPcPflpwi+eoz95uqc8L+AH60wlvKcvEDw5mv4V0/hv/0Gyc1TJMEafwLgbq5ePprRbQAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n          <source\n              srcset=\"/static/f55ac2240ebf695fba5b5f5de08cee30/59d6e/cloudfront-custom-error-response.webp 180w,\n/static/f55ac2240ebf695fba5b5f5de08cee30/a3012/cloudfront-custom-error-response.webp 360w,\n/static/f55ac2240ebf695fba5b5f5de08cee30/bc514/cloudfront-custom-error-response.webp 720w,\n/static/f55ac2240ebf695fba5b5f5de08cee30/8c521/cloudfront-custom-error-response.webp 1046w\"\n              sizes=\"(max-width: 720px) 100vw, 720px\"\n              type=\"image/webp\"\n            />\n          <source\n            srcset=\"/static/f55ac2240ebf695fba5b5f5de08cee30/e9ff0/cloudfront-custom-error-response.png 180w,\n/static/f55ac2240ebf695fba5b5f5de08cee30/f21e7/cloudfront-custom-error-response.png 360w,\n/static/f55ac2240ebf695fba5b5f5de08cee30/37523/cloudfront-custom-error-response.png 720w,\n/static/f55ac2240ebf695fba5b5f5de08cee30/1c1a4/cloudfront-custom-error-response.png 1046w\"\n            sizes=\"(max-width: 720px) 100vw, 720px\"\n            type=\"image/png\"\n          />\n          <img\n            class=\"gatsby-resp-image-image\"\n            src=\"/static/f55ac2240ebf695fba5b5f5de08cee30/37523/cloudfront-custom-error-response.png\"\n            alt=\"cloudfront-custom-error-response.png\"\n            title=\"\"\n            loading=\"lazy\"\n            decoding=\"async\"\n            style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n          />\n        </picture>\n  </a>\n    </span></p>\n<p>CloudFront의 <strong>사용자 정의 오류 응답(Custom error response)</strong> 을 사용하면 에러 코드별로 어떻게 처리할지 세세하게 설정할 수 있습니다.</p>\n<ul>\n<li>\n<p>장점:</p>\n<ul>\n<li>\n<p>오류 코드별로 세세한 설정을 할 수 있어 유연성이 높음</p>\n</li>\n<li>\n<p>캐싱 기능을 통해 성능을 높일 수 있음</p>\n</li>\n</ul>\n</li>\n<li>\n<p>단점:</p>\n<ul>\n<li>CloudFront 사용에 따른 추가 비용이 발생할 수 있음</li>\n</ul>\n</li>\n</ul>\n<p>어느 방법을 사용하든 SPA는 정상적으로 동작하지만, SEO 친화적인 처리를 위해 저는 CloudFront에서 오류를 처리하는 방식을 선택했습니다.</p>\n<h2>결론</h2>\n<p>저는 프론트엔드 개발을 Next.js로 시작했기 때문에, SPA나 CSR에 대해서는 이론적으로만 공부했을 뿐 실제로 배포까지 진행해본 적은 없었습니다. 그렇기에 이번에 겪은 문제는 다소 생소했습니다.</p>\n<p>아마도 아직 SSR 프레임워크가 널리 사용되기 전에는 꽤 일반적인 문제였을 것입니다. Next.js와 같은 SSR 프레임워크가 보편화되면서 서버 로직과 인프라에 대한 고민을 덜 하게 되었지만, 이번 경험을 통해 프론트엔드 개발자라도 인프라와 배포 과정에 대한 이해가 중요함을 다시금 깨달았습니다.</p>","frontmatter":{"title":"SPA 404 이슈 해결","date":"2024-07-19","tags":["AWS","Troubleshooting"],"thumbnail":null},"timeToRead":2}},"pageContext":{"id":"26c8733b-b1f2-5256-a247-0cb8da982c8b"}},"staticQueryHashes":["1147043159"],"slicesMap":{}}